---
title: "QA-证书过期了可是服务还能用"
---
我们公司和ELK做交互的证书过期了
这个证书是双向验证的（extendedKeyUsage=[serverAuth, clientAuth]）
我们这边和ELK服务端都是启4个nodes
然后今早证书过期，可是到了下午查询服务才偶尔不可用。
问了GPT这个情况咋回事，一下是他的回答，说的头头是道，感觉他也没有骗人😂

### 不是说每次https的请求都会验证CA证书吗？为什么又说“一些客户端会在首次连接时缓存服务器的证书，以避免在每次连接时都重新验证证书”呢？

    您提出了一个很好的问题。让我澄清一下。
    
    在 HTTPS 连接中，客户端通常会验证服务器提供的证书，以确保连接的安全性。这种验证通常包括检查证书是否由受信任的证书颁发机构（CA）签发，证书是否在有效期内，以及证书中的域名是否与服务器的域名匹配等步骤。这种验证过程确保了客户端和服务器之间建立的安全连接是可信的。
    
    然而，一些客户端确实会在首次连接时缓存服务器的证书，以避免在每次连接时都重新验证证书。这是为了提高性能和降低连接延迟。一旦客户端缓存了服务器的证书，并且在证书过期后仍然使用缓存的证书进行通信，那么就可以继续正常交互，即使证书已经过期。
    
    这种行为可能存在一定的安全风险，因为过期的证书可能意味着证书私钥的安全性无法得到保证，或者证书信息已经过时。因此，尽管一些客户端可能会缓存证书以提高性能，但最佳实践仍然是在证书过期后尽快更新证书，以确保通信的安全性。
    
    希望这样能够解答您的疑问。

### ELK的服务器和客户端的jar会缓存证书吗？
在使用 ELK（Elasticsearch、Logstash 和 Kibana）时，通常会涉及到 SSL/TLS 加密和证书验证。对于 Elasticsearch、Logstash 和 Kibana 作为客户端的情况，它们会根据配置来处理证书的缓存和验证。

1. Elasticsearch 作为服务器：Elasticsearch 作为服务器会使用 SSL/TLS 来加密通信，并且可能需要配置证书以进行客户端验证。在这种情况下，Elasticsearch 服务器会使用 Java Keystore 和 Truststore 来存储证书和信任的 CA 证书。这些证书可能会被缓存，以便在通信过程中进行验证。
2. Logstash 作为客户端：当 Logstash 作为客户端连接到 Elasticsearch 时，它也可能需要配置 SSL/TLS 和证书验证。在这种情况下，Logstash 可能会缓存服务器的证书，以避免在每次连接时都重新验证证书。
3. Kibana 作为客户端：类似地，Kibana 作为客户端连接到 Elasticsearch 时，也会涉及 SSL/TLS 和证书验证。它可能会缓存服务器的证书，以提高连接性能。

需要注意的是，这些行为可能会受到具体配置的影响，包括证书的过期时间和缓存策略等。因此，在使用 ELK 时，建议仔细查阅官方文档并根据最佳实践进行配置，以确保安全和性能之间的平衡。

总的来说，ELK 的服务器和客户端在 SSL/TLS 加密通信中可能会涉及证书的缓存和验证，具体行为取决于配置和实际应用场景。